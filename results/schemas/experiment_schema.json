{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Eigenspectrum Experiment Metadata",
  "type": "object",
  "required": ["version", "analysis__method", "data__modality", "data__split"],
  "properties": {

    "version": {
      "type": "string",
      "description": "Experiment version identifier (e.g., 'v13')"
    },

    "title": {
      "type": "string",
      "description": "Short human-readable title"
    },

    "description": {
      "type": "string",
      "description": "Brief description of the experimental question"
    },

    "experiment_group": {
      "type": "string",
      "description": "Logical grouping for related experiments",
      "enum": [
        "plantcad2_baseline",
        "plantcad2_context_ablation",
        "marin_poc",
        "marin_isoflop_large_width",
        "marin_isoflop_small_width",
        "marin_simulation",
        "marin_species_filter",
        "animals_promoter",
        "text_baseline",
        "data_only"
      ]
    },

    "analysis__method": {
      "type": "string",
      "enum": ["model_activation_pca", "sequence_pca", "kmer_pca"],
      "description": "Type of eigenanalysis (model-based vs data-only)"
    },

    "analysis__context_length": {
      "type": "integer",
      "description": "Sequence/context length in tokens or bp"
    },

    "analysis__pooling_method": {
      "type": "string",
      "enum": ["single_token", "mean", "max", "none"],
      "description": "Activation pooling strategy: single_token (center for MLM, last for CLM), mean, max, or none (for data-only)"
    },

    "analysis__sample_sizes": {
      "type": "array",
      "items": { "type": "integer" },
      "description": "Sample sizes analyzed"
    },

    "analysis__max_sample_size": {
      "type": "integer",
      "description": "Maximum sample size analyzed (max of analysis__sample_sizes)"
    },

    "analysis__max_rank": {
      "type": "integer",
      "description": "Maximum rank in eigenspectrum (typically model hidden dimension)"
    },

    "model__name": {
      "type": ["string", "null"],
      "description": "Model name/identifier (null for data-only experiments)"
    },

    "model__type": {
      "type": ["string", "null"],
      "enum": ["MLM", "CLM", null],
      "description": "Model type: Masked LM or Causal LM"
    },

    "model__source": {
      "type": ["string", "null"],
      "enum": [
        "sequence",
        "plantcad", "plantcad_rand",
        "marin", "marin_rand",
        "ntv2", "ntv2_rand",
        "hyena", "hyena_rand",
        "gpn", "gpn_rand",
        "glmexp", "glmexp_rand",
        null
      ],
      "description": "Feature source matching --source argument in plantcad_eigenanalysis.py"
    },

    "model__training_status": {
      "type": ["string", "null"],
      "enum": ["trained", "random_init", null],
      "description": "Whether the model was trained or is randomly initialized"
    },

    "model__flop_budget": {
      "type": ["number", "null"],
      "description": "Training FLOP budget if from IsoFLOP study"
    },

    "model__width_class": {
      "type": ["string", "null"],
      "enum": ["large", "small", null],
      "description": "Width classification for IsoFLOP models"
    },

    "model__simulation_mode": {
      "type": ["string", "null"],
      "enum": ["none", "high_homology", "low_homology", "random", null],
      "description": "Sequence simulation mode applied during training"
    },

    "data__modality": {
      "type": "string",
      "enum": ["dna", "text"],
      "description": "Data type"
    },

    "data__kingdom": {
      "type": ["string", "null"],
      "enum": ["plants", "animals", null],
      "description": "Biological kingdom (null for text)"
    },

    "data__dataset": {
      "type": "string",
      "description": "Dataset name or HuggingFace path"
    },

    "data__split": {
      "type": "string",
      "enum": ["train", "validation", "test"],
      "description": "Data split used"
    },

    "data__species_filter": {
      "type": ["string", "null"],
      "enum": ["all", "single_species", "species_subset", null],
      "description": "Type of species filtering applied (null for text or when not applicable)"
    },

    "data__species_filter_value": {
      "type": ["string", "array", "null"],
      "description": "Specific species or list of species if filtered",
      "items": { "type": "string" }
    },

    "reference__github_issue": {
      "type": ["string", "null"],
      "description": "Link to related GitHub issue"
    },

    "reference__wandb_run": {
      "type": ["string", "null"],
      "description": "Link to W&B run"
    },

    "reference__model_hub_path": {
      "type": ["string", "null"],
      "description": "HuggingFace model path"
    }
  }
}

